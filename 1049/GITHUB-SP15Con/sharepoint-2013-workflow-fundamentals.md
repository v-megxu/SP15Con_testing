---
title: Основные сведения о рабочих процессах в SharePoint 2013
ms.prod: SHAREPOINT
ms.assetid: 1e622296-f78b-4e3a-a1e7-8effa24111a8
---


# Основные сведения о рабочих процессах в SharePoint 2013
В этой статье представлен высокоуровневый обзор инфраструктуры рабочих процессов в SharePoint 2013, в том числе описание архитектуры платформы и мост взаимодействия рабочих процессов.
## Обзор рабочих процессов в SharePoint 2013
<a name="bkm_overview"> </a>

Рабочие процессы SharePoint 2013 основаны на платформе Windows Workflow Foundation 4, которая была существенно переработана по сравнению с предыдущими версиями. Платформа Windows Workflow Foundation (WF), в свою очередь, основана на функциях обмена сообщениями  [Windows Communication Foundation (WCF)](http://msdn.microsoft.com/ru-ru/library/vstudio/ms735119%28v=vs.90%29.aspx).
  
    
    
По сути, модель рабочие процессы моделируют структурированные бизнес-процессы. Поэтому рабочие процессы Windows Workflow Foundation 4  это структурированная коллекция "действий" рабочего процесса, каждое из которых представляет функциональный компонент бизнес-процесса.
  
    
    
Платформа рабочих процессов в SharePoint 2013 использует модель действий Windows Workflow Foundation 4 для представления бизнес-процессов на основе SharePoint. Кроме того, в SharePoint 2013 реализована высокоуровневая модель "шлюз-стадия", на основе которой создаются рабочие процессы.
  
    
    
Важно отметить связь между действиями рабочего процесса идействиями SharePoint. Действия рабочего процесса представляют базовые управляемые объекты, методы которых определяют поведение рабочего процесса. С другой стороны, действия рабочего процесса  это оболочка, инкапсулирующая базовые действия и представляющая их в понятное SharePoint Designer форме. Создатели рабочих процессов взаимодействуют с действиями рабочего процесса, в то время как модуль выполнения рабочих процессов работает на основе соответствующих действий.
  
    
    
Действия, т. е. реализация классов действий, декларативно реализуются с помощью XAML.
  
    
    
Действия рабочих процессов вызываются с помощью слабосвязанных веб-служб, использующих API-интерфейсы для взаимодействия с SharePoint. Эти API-интерфейсы основаны на функциях обмена сообщениями  [Windows Communication Foundation (WCF)](http://msdn.microsoft.com/ru-ru/library/vstudio/ms735119%28v=vs.90%29.aspx).
  
    
    
Инфраструктура обмена сообщениями очень гибкая и поддерживает практически любой шаблон обмена сообщениями, который вам может понадобиться. Обратите внимание, что в ферме SharePoint 2013Windows Workflow Foundation и WCF размещены в Workflow Manager Client 1.0.
  
    
    
Workflow Manager Client 1.0, SharePoint 2013 и SharePoint Designer 2013 предоставляют важные компоненты новой инфраструктуры:
  
    
    

- **Workflow Manager Client 1.0** обеспечивает управление определениями рабочих процессов. В нем также размещаются процессы выполнения экземпляров рабочих процессов.
    
  
- **SharePoint 2013** предоставляет платформу для рабочих процессов SharePoint, которые моделируют бизнес-процессы на основе SharePoint, связанные с документами, списками, пользователями и задачами SharePoint. Кроме того, рабочие процессы, сопоставления, действия и другие метаданные рабочих процессов SharePoint хранятся и контролируются в SharePoint 2013.
    
  
- **SharePoint Designer 2013**  это основное средство, с помощью которых бизнес-пользователей создают определения рабочего процесса и публикуют их, как и в предыдущих версиях. Оно также используется для упаковки определения рабочего процесса со связанными компонентами SharePoint или без них.
    
  

## Архитектура платформы
<a name="bkm_Architecture"> </a>

На рис. 1 показано высокоуровневое представление платформы рабочих процессов SharePoint 2013. Во-первых, обратите внимание на то, что в новой инфраструктуре рабочих процессов Workflow Manager Client 1.0 используется в качестве узла выполнения рабочих процессов. В предыдущих же версиях узел выполнения рабочих процессов размещался в самом SharePoint, но это изменилось в SharePoint 2013. Workflow Manager Client 1.0  это внешний компонент, который взаимодействует с SharePoint с помощью общих протоколов через шину обслуживания Microsoft Azure посредством OAuth. Кроме того, SharePoint содержит компоненты, которые можно было ожидать: элементы контента, события, приложения и т. д. Но обратите внимание, что также существует реализация узла выполнения рабочих процессов в SharePoint 2010 (т. е. модуль Windows Workflow Foundation 3) для обеспечения обратной совместимости. Подробнее об этом написано в статье  [Использование средств взаимодействия рабочих процессов для SharePoint 2013](use-workflow-interop-for-sharepoint-2013.md).
  
    
    

**Рис. 1. Высокоуровневая архитектура инфраструктуры рабочих процессов**

  
    
    

  
    
    
![Высокоуровневая архитектура рабочего процесса](images/wfArchitecture1.png)
  
    
    
Workflow Manager Client 1.0 представлен в SharePoint 2013 в виде прокси приложения-службы Workflow Manager Client 1.0. Этот компонент позволяет SharePoint взаимодействовать с сервером Workflow Manager Client 1.0. Межсерверная проверка подлинности выполняется с помощью OAuth.
  
    
    
События SharePoint, которые прослушивает рабочий процесс, например **itemCreated**, **itemUpdated** и т. д., направляются Workflow Manager Client 1.0 с помощью шины обслуживания Microsoft Azure. Для обратного вызова SharePoint платформа использует API REST SharePoint.
  
    
    
Существуют также дополнения к объектной модели рабочих процессов SharePoint, которые коллективно называются диспетчером служб рабочих процессов. Он позволяет управлять рабочими процессами и контролировать их выполнение. Основные зоны взаимодействия диспетчера служб  это развертывание, обмен сообщениями, управление экземплярами и взаимодействие с рабочими процессами SharePoint 2010 (для обеспечения обратной совместимости).
  
    
    
Наконец, существует компонент создания рабочих процессов. Теперь SharePoint Designer может создать и развертывать рабочие процессы SharePoint 2010 и SharePoint 2013. Visual Studio 2012 не только предоставляет поверхность разработки для создания декларативных рабочих процессов, но и позволяет создавать Надстройки SharePoint и решения, которые полностью интегрируются с Workflow Manager Client 1.0.
  
    
    

## Подписки и сопоставления рабочих процессов
<a name="bkm_Subscriptions"> </a>

Поскольку наиболее значительное изменение рабочих процессов SharePoint 2013  это перемещение обработки рабочих процессов на внешние узлы, такие как Microsoft Azure, было крайне важно связать сообщения и события SharePoint с инфраструктурой рабочих процессов в Microsoft Azure. Кроме того, в Microsoft Azure было необходимо связать инфраструктуру с данными клиента. Сопоставления рабочих процессов (основанные на концепции подписок WF)  это компоненты инфраструктуры SharePoint, которые поддерживают эти требования.
  
    
    

### Служба публикации и подписки Microsoft Azure

Перед обсуждением сопоставлений и подписок рабочих процессов необходимо изучить службу публикации и подписки Microsoft Azure, которую иногда называютpub/sub (PubSub). PubSub  это асинхронная платформа обмена сообщениями. Отправители сообщений (издатели) не передают сообщения напрямую получателям (подписчикам). Вместо этого сообщения обрабатываются издателями как классы без каких-либо сведениях о подписчиках. Затем подписчики определяют интересующие их сообщения, независимо от издателя, основываясь на созданных подписках.
  
    
    
Подобное отделение создания сообщения от потребления сообщения обеспечивает масштабируемость и гибкость, а также позволяет отправлять многоадресные сообщения со стороны издателя и потреблять произвольные сообщения со стороны подписчика.
  
    
    

> **Примечание**
> PubSub  это компонент шины обслуживания Microsoft Azure, который предоставляет возможности подключения для WCF и других конечных точек службы. К ним относятся конечные точки REST, которые могут быть расположены за границами преобразования сетевых адресов (NAT) или могут быть привязаны к часто изменяющимся, динамически назначаемым IP-адресам (или и то, и другое). Дополнительные сведения о шине обслуживания Azure см. в разделе  [Шина обслуживания](http://msdn.microsoft.com/ru-ru/library/ee732537.aspx). 
  
    
    


### Сопоставления рабочих процессов и область сопоставлений

Сопоставления рабочих процессов связывают определения рабочих процессов с областью SharePoint и определенными значениями по умолчанию. Сопоставления сами по себе  это набор правил подписки, которые хранятся в службе публикации и подписки Azure, которые обрабатывают входящие сообщения для их передачи соответствующим (т. е. подписанным) экземплярам рабочих процессов.
  
    
    
По умолчанию инфраструктуры обмена сообщениями поддерживает рабочие процессы в следующих областях:
  
    
    

-  [SPList](https://msdn.microsoft.com/library/Microsoft.SharePoint.SPList.aspx) (для рабочих процессов списка);
    
  
-  [SPWeb](https://msdn.microsoft.com/library/Microsoft.SharePoint.SPWeb.aspx) (для рабочих процессов сайта).
    
  
В отличие от предыдущих версий SharePoint 2013 не поддерживает рабочие процессы, относящиеся к типу контента ( [SPContentType](https://msdn.microsoft.com/library/Microsoft.SharePoint.SPContentType.aspx) ). Тем не менее, инфраструктура обмена сообщениями расширяема, поэтому она может поддерживать произвольные области. Разработчик может задать в свойстве [EventSourceId](https://msdn.microsoft.com/library/Microsoft.SharePoint.WorkflowServices.WorkflowSubscription.EventSourceId.aspx) экземпляра [WorkflowSubscription](https://msdn.microsoft.com/library/Microsoft.SharePoint.WorkflowServices.WorkflowSubscription.aspx) любой идентификатор **guid**. Затем можно использовать значение **EventSourceId** для вызова метода **PublishEvent(Guid, String, IDictionary<String, Object>)**, который запускает новый экземпляр рабочего процесса для указанной подписки **WorkflowSubscription**.
  
    
    

### Служба рабочих процессов в Microsoft Azure

Сопоставления рабочих процессов SharePoint представляются службой рабочих процессов в Microsoft Azure. Если приложению требуется получить сопоставление рабочего процесса и его данные, сначала оно запрашивает все службы рабочих процессов, доступные в заданной области.
  
    
    
Аналогичным образом экземпляры рабочих процессов содержат указатель на соответствующую службу рабочих процессов. С его помощью определяется правильное сопоставление.
  
    
    

### Запуск рабочих процессов

Рабочие процессы можно запустить вручную или автоматически.
  
    
    
 **Ручные рабочие процессы**
  
    
    
Ручные рабочие процессы запускаются, когда служба PubSub получает сообщение **StartWorkflow**. Оно содержит следующие сведения:
  
    
    

- Идентификатор сопоставления (т. е. экземпляр **WorkflowSubscription**).
    
  
- Идентификатор исходного контекста элемента. Он передается в параметре  _ItemId_ и свойстве **EventSource** при вызове метода **PublishEvent**.
    
  
- Тип события для запуска вручную ( **WorkflowStart**).
    
  
- Дополнительные параметры запуска рабочих процессов (из подписки или формы **Init**). Это может быть **CorrelationId** для подписки или **WFInstanceId** для формы **Init**.
    
  
 **Рабочие процессы с автоматическим запуском**
  
    
    
Рабочие процессы с автоматическим запуском инициируются с помощью сообщения **Add**, передаваемого службе PubSub. Оно содержит следующие сведения:
  
    
    

- Идентификатор исходного контекста элемента.
    
  
- Само событие  это обычное событие SharePoint **Add**.
    
  
- Параметры запуска рабочего процесса.
    
  

> **Примечание**
> Если рабочий процесс запускается автоматически для повторяющегося события (например, **OnItemChanged**), он не может запустить другой рабочий процесс данного сопоставления до завершения выполнения существующего экземпляра рабочего процесса сопоставления. 
  
    
    


### Подписки рабочих процессов

Естественным дополнением сопоставлений служат подписки, которые позволяют рабочему процессу взаимодействовать с сопоставлениями. Рабочий процесс должен создать подписки в шине обслуживания Azure с помощью методов **create** и **delete**.
  
    
    
Сигнатуры методов, которые создают подписки и экземпляр рабочего процесса, определяют обязательные и необязательные параметры. Списки параметров указывает автор рабочего процесса, поэтому они могут отличаться для разных определений рабочих процессов. Список параметров подписки указывается в виде метаданных в определениях рабочих процессов. Параметры подписки предоставляется при ее создании. Список параметров инициализации указывается в XAML как часть определения рабочего процесса. Параметры инициализации предоставляются при создании экземпляра рабочего процесса.
  
    
    
Подписки привязаны к определенному объекту SharePoint: экземпляру **SPList** или экземпляру **SPWeb**. Тип объекта подписки передается как значение обязательного параметра при создании подписки. Тип объекта определяет область подписки, чтобы она реагировала только на события, происходящие в объекте, на который он подписан.
  
    
    

## Взаимодействие рабочих процессов SharePoint
<a name="bkm_InteropBridge"> </a>

Взаимодействие рабочих процессов SharePoint позволяет вызывать рабочие процессы SharePoint 2010 (основанные на Windows Workflow Foundation 3) из рабочих процессов SharePoint 2013, которые основаны на Windows Workflow Foundation 4. Это позволяет выполнять рабочие процессы SharePoint 2010 из рабочих процессов SharePoint 2013.
  
    
    
Это важно, так как у вас может быть среда SharePoint 2010, которую вы можете использовать повторно вместе с рабочими процессами SharePoint 2013. Кроме того, вы можете использовать действия или функции SharePoint 2010, который еще не реализованы в SharePoint 2013
  
    
    
Полное обсуждение взаимодействия рабочих процессов SharePoint см. в разделе  [Использование средств взаимодействия рабочих процессов для SharePoint 2013](use-workflow-interop-for-sharepoint-2013.md).
  
    
    

## Дополнительные ресурсы
<a name="bk_additional"> </a>


-  [Общие сведения о рабочих процессах в SharePoint 2013](get-started-with-workflows-in-sharepoint-2013.md)
    
  
-  [Справочник по действий рабочих процессов для SharePoint 2013](workflow-actions-and-activities-reference-for-sharepoint-2013.md)
    
  
-  [Разработка рабочих процессов в SharePoint 2013 с помощью Visual Studio](develop-sharepoint-2013-workflows-using-visual-studio.md)
    
  
-  [Разработка рабочих процессов в SharePoint Designer и Visio](workflow-development-in-sharepoint-designer-and-visio.md)
    
  
-  [Рабочие процессы в SharePoint 2013](workflows-in-sharepoint-2013.md)
    
  
-  [Использование средств взаимодействия рабочих процессов для SharePoint 2013](use-workflow-interop-for-sharepoint-2013.md)
    
  

