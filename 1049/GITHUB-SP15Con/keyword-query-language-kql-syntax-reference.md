---
title: Справочник по синтаксису языка запросов по ключевым словам (KQL)
ms.prod: SHAREPOINT
ms.assetid: d8489f59-522f-433c-b9c1-69e597be51c7
---



# Справочник по синтаксису языка запросов по ключевым словам (KQL)
Узнайте, как создавать KQL-запросы для Поиск в SharePoint 2013. Этот справочник по синтаксису описывает элементы KQL-запросов, а также порядок использования ограничений свойств и операторов в таких запросах.
## Элементы KQL-запроса
<a name="SP15KQL_elements"> </a>

KQL-запрос состоит из одного или нескольких элементов, перечисленных далее. 
  
    
    

- Ключевые слова с произвольным текстом (слова или фразы) 
    
  
- Ограничения свойств 
    
  
Элементы KQL-запросов можно комбинировать с одним или несколькими доступными операторами.
  
    
    
Недопустимы те KQL-запросы, которые пустые или содержат только операторы. KQL-запросы не чувствительны к регистру, а операторы  чувствительны (верхний регистр).
  
    
    

> **Примечание**
> Ограничение длины KQL-запроса зависит от способа его создания. При создании такого запроса с помощью интерфейса поиска SharePoint, доступного по умолчанию, максимальная длина запроса составляет 2048 символов. Если же вы создаете KQL-запросы программным путем с помощью объектной модели запроса, максимальная длина запроса по умолчанию составляет 4096 символов. Вы можете увеличить длину запроса до 20 480 символов с помощью свойства  [MaxKeywordQueryTextLength](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.SearchServiceApplication.MaxKeywordQueryTextLength.aspx) или свойства [DiscoveryMaxKeywordQueryTextLength](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.SearchServiceApplication.DiscoveryMaxKeywordQueryTextLength.aspx) (для обнаружения электронных данных).
  
    
    


## Построение запросов с произвольным текстом с помощью KQL
<a name="SP15KQL_constructing_freetext_queries"> </a>

При создании KQL-запроса с использованием произвольных выражений Поиск в SharePoint 2013 подбирает результаты с совпадениями для выбранных вами терминов, основываясь на терминах, хранящихся в полнотекстовом индексе. Сюда входят значения управляемых свойств, в которых параметр  [FullTextQueriable](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedProperty.FullTextQueriable.aspx) имеет значение **true**.
  
    
    
KQL-запросы с произвольным текстом не чувствительны к регистру, однако операторы должны быть записаны заглавными буквами. Вы можете строить KQL-запросы с помощью одного или нескольких произвольных выражений:
  
    
    

- **word** (содержит один или несколько символов без пробелов и знаков препинания);
    
  
- **phrase** (содержит два и более слов, разделенных пробелами и обязательно заключенных в двойные кавычки).
    
  
Чтобы создать сложные запросы, вы можете комбинировать несколько произвольных выражений с помощью операторов KQL-запросов. Если операторы между выражениями отсутствуют, запрос будет выполняться так же, как при использовании оператора **AND**.
  
    
    

### Использование слов в KQL-запросе с произвольным текстом

Если вы используете слова в KQL-запросе с произвольным текстом, служба Поиск в SharePoint 2013 возвращает результаты с точным совпадением этих слов с терминами, хранящимися в полнотекстовом индексе. Можно указывать только начальную часть слова, применяя оператор подстановочного знака (*) для включения сопоставления префиксов. При таком сопоставлении служба Поиск в SharePoint 2013 подбирает совпадения с терминами, содержащими искомое слово, за которым могут следовать другие символы.
  
    
    
Например, следующие KQL­-запросы вернут элементы, содержащие термины "federated" и "search": 
  
    
    
 `federated search`
  
    
    
 `federat* search`
  
    
    
 `search fed*`
  
    
    
KQL­-запросы не поддерживают сопоставление суффиксов.
  
    
    

### Использование фраз в KQL-запросе с произвольным текстом

Если вы используете фразы в KQL-запросе с произвольным текстом, служба Поиск в SharePoint 2013 возвращает только элементы, в которых есть слова из вашей фразы, следующие друг за другом. Чтобы задать фразу в KQL-запросе, необходимо использовать двойные кавычки. 
  
    
    
KQL-запросы не поддерживают сопоставление суффиксов, поэтому в запросах с произвольным текстом нельзя использовать оператор подстановочного знака перед фразой. Однако вы можете использовать оператор подстановочного знака после фразы.
  
    
    

## Запросы с ограничениями свойств в KQL
<a name="kql_property_restriction_queries"> </a>

С помощью KQL вы можете строить запросы, использующие ограничения свойств, чтобы получать результаты запроса только по заданному условию.
  
    
    

### Задание ограничений свойств

Базовое ограничение свойств состоит из перечисленных ниже элементов.
  
    
    
 `<Property Name><Property Operator><Property Value>`
  
    
    
В таблице 1 приведены некоторые примеры допустимого синтаксиса ограничений свойств в KQL-запросах.
  
    
    

**Таблица 1. Допустимый синтаксис ограничений свойств**


|**Синтаксис**|**Возвращаемое значение**|
|:-----|:-----|
| `author:"John Smith"` <br/> |Возвращает элементы контента, автором которого является John Smith.  <br/> |
| `filetype:docx` <br/> |Возвращает документы Microsoft Word.  <br/> |
| `filename:budget.xlsx` <br/> |Возвращает элементы, содержащие имя файла  `budget.xlsx`.  <br/> |
   
Ограничение свойства не должно содержать пробелы между именем, оператором и значением этого свойства. Иначе это ограничение будет обрабатываться как запрос с произвольным текстом. Максимальная длина ограничения свойства составляет 2048 символов. 
  
    
    
В следующих примерах наличие пробела приводит к тому, что запрос возвращает элементы, содержащие термины "author" и "John Smith", вместо элементов контента, автором которого является John Smith:
  
    
    
 `author: "John Smith"`
  
    
    
 `author :"John Smith"`
  
    
    
 `author : "John Smith"`
  
    
    
Другими словами, описанные выше ограничения свойств эквивалентны следующему запросу:
  
    
    
 `author "John Smith"`
  
    
    

### Указание имен свойств для ограничений свойств

Необходимо указать допустимое имя управляемого свойства для ограничения свойства. По умолчанию в Поиск в SharePoint 2013 входит несколько управляемых свойств для документов.
  
    
    
Чтобы задать ограничение для значения свойства, извлеченного при обходе контента, сначала необходимо сопоставить это свойство с управляемым свойством. См. раздел **Управляемые свойства и свойства для обхода** статьи [Планирование методов поиска для конечных пользователей (Office SharePoint Server)](http://technet.microsoft.com/ru-ru/library/cc263089.aspx). 
  
    
    
Управляемое свойство должно относиться к типу  [Queryable](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedProperty.Queryable.aspx) , чтобы вы могли искать это управляемое свойство в документе. Кроме того, управляемое свойство может относиться к типу [Retrievable](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedProperty.Retrievable.aspx) , чтобы можно было его извлечь. Однако управляемое свойство не обязательно должно относиться к типу [Retrievable](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedProperty.Retrievable.aspx) , чтобы можно было найти свойство.
  
    
    

### Операторы свойств, поддерживаемые в ограничениях свойств

Служба Поиск в SharePoint 2013 поддерживает несколько операторов свойств для ограничений свойств, приведенных в таблице 2. 
  
    
    

**Таблица 2. Допустимые операторы свойств для ограничений свойств**


|**Оператор**|**Описание**|**Поддерживаемый тип управляемого свойства**|
|:-----|:-----|:-----|
|:  <br/> |Возвращает результаты, в которых указанное в ограничении свойства значение равно значению свойства, хранящегося в базе данных хранилища свойств, или совпадает с отдельными терминами в значении свойства, хранящегося в полнотекстовом индексе.  <br/> | [Text](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Text.aspx) <br/>  [DateTime](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.DateTime.aspx) <br/>  [Integer](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Integer.aspx) <br/>  [Decimal](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Decimal.aspx) <br/>  [Double](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Double.aspx) <br/>  [YesNo](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.YesNo.aspx) <br/> |
|=  <br/> |Возвращает результаты со значениями свойств, равными значению, указанному в ограничении свойств.  <br/> > **Примечание**> Не рекомендуется комбинировать оператор **=** со знаком звездочки ( *****), если нужно найти точное совпадение.           | [Text](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Text.aspx) <br/>  [DateTime](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.DateTime.aspx) <br/>  [Integer](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Integer.aspx) <br/>  [Decimal](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Decimal.aspx) <br/>  [Double](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Double.aspx) <br/>  [YesNo](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.YesNo.aspx) <br/> |
|<  <br/> |Возвращает результаты, в которых значение свойства меньше значения, указанного в ограничении свойства.  <br/> | [DateTime](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.DateTime.aspx) <br/>  [Integer](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Integer.aspx) <br/>  [Decimal](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Decimal.aspx) <br/>  [Double](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Double.aspx) <br/> |
|>  <br/> |Возвращает результаты, в которых значение свойства больше значения, указанного в ограничении свойства.  <br/> | [DateTime](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.DateTime.aspx) <br/>  [Integer](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Integer.aspx) <br/>  [Decimal](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Decimal.aspx) <br/>  [Double](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Double.aspx) <br/> |
|<=  <br/> |Возвращает результаты со значением свойства, меньшим или равным значению, указанному в ограничении свойства.  <br/> | [DateTime](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.DateTime.aspx) <br/>  [Integer](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Integer.aspx) <br/>  [Decimal](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Decimal.aspx) <br/>  [Double](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Double.aspx) <br/> |
|>=  <br/> |Возвращает результаты со значением свойства, большим или равным значению, указанному в ограничении свойства.  <br/> | [DateTime](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.DateTime.aspx) <br/>  [Integer](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Integer.aspx) <br/>  [Decimal](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Decimal.aspx) <br/>  [Double](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Double.aspx) <br/> |
|<>  <br/> |Возвращает результаты со значением свойства, не равным значению, указанному в ограничении свойства.  <br/> | [DateTime](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.DateTime.aspx) <br/>  [Integer](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Integer.aspx) <br/>  [Decimal](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Decimal.aspx) <br/>  [Text](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Text.aspx) <br/>  [Double](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Double.aspx) <br/>  [YesNo](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.YesNo.aspx) <br/> |
|..  <br/> |Возвращает результаты, в которых значение свойства включено в диапазон, указанный в ограничении свойства.  <br/> Например, диапазон A..B представляет собой набор значений от A до B со значениями A и B включительно. Для диапазонов дат такая запись означает диапазон от начала дня A до конца дня B.  <br/> | [DateTime](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.DateTime.aspx) <br/>  [Integer](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Integer.aspx) <br/>  [Decimal](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Decimal.aspx) <br/>  [Double](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Double.aspx) <br/> |
   

### Указание значений свойств

Укажите значение свойства, имеющего допустимый тип данных для типа управляемого свойства. В таблице 3 приведен перечень сопоставлений типов.
  
    
    

**Таблица 3. Соответствие допустимых типов данных типам управляемых свойств**


|**Тип управляемых свойств**|**Тип данных**|
|:-----|:-----|
| [Text](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Text.aspx) <br/> | [String](https://msdn.microsoft.com/library/System.String.aspx) <br/> |
| [Integer](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Integer.aspx) <br/> | [Int64](https://msdn.microsoft.com/library/System.Int64.aspx) <br/> |
| [Double](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Double.aspx) <br/> | [System.Double](https://msdn.microsoft.com/library/System.Double.aspx) <br/> |
| [Decimal](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.Decimal.aspx) <br/> | [Decimal](https://msdn.microsoft.com/library/System.Decimal.aspx) <br/> |
| [DateTime()](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.DateTime.aspx) <br/> | [DateTime](https://msdn.microsoft.com/library/System.DateTime.aspx) <br/> |
| [YesNo](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedDataType.YesNo.aspx) <br/> | [Boolean](https://msdn.microsoft.com/library/System.Boolean.aspx) <br/> |
   

#### Значения текстовых свойств

В случае значений текстовых свойств ход сопоставления зависит от того, хранится ли свойство в полнотекстовом индексе или в индексе поиска. 
  
    
    

#### Значения свойств в полнотекстовом индексе

Значения свойств хранятся в полнотекстовом индексе, когда свойству **FullTextQueriable** присвоено значение **true** для управляемого свойства. Эту настройку можно использовать только для строковых свойств. Значения свойств, указанные в запросе, сопоставляются с отдельными терминами, которые хранятся в полнотекстовом индексе. Используйте свойство [NoWordBreaker](https://msdn.microsoft.com/library/Microsoft.Office.Server.Search.Administration.ManagedProperty.NoWordBreaker.aspx) , чтобы указать, должен ли проводиться поиск совпадений с полным значением свойства.
  
    
    
Например, если вы ищете элемент контента, созданный пользователем Paul Shakespear, такой KQL-запрос возвращает результаты с совпадениями:
  
    
    
 `author:Shakespear`
  
    
    
 `author:Paul`
  
    
    
Кроме того, поддерживается сопоставление префиксов. Вы можете использовать оператор подстановочного знака (*), однако он не требуется при указании отдельных слов. Перейдем к следующему примеру. Этот KQL-запрос тоже возвращает элементы контента, созданные пользователем Paul Shakespear: 
  
    
    
 `author:Shakesp*`
  
    
    
Когда вы указываете фразу для значения свойства, результаты с совпадениями должны содержать указанную фразу в значении свойства, хранящегося в полнотекстовом индексе. Такой запрос возвращает элементы контента с текстом "Advanced Search" в названии, например "Advanced Search XML" и "Learning About the Advanced Search Web Part":
  
    
    
 `title:"Advanced Search"`
  
    
    
Сопоставление префиксов также поддерживается для фраз, указанных в значениях свойств. Но в этом случае в запросе следует использовать оператор подстановочного знака (*), который допустим только в конце фразы, например:
  
    
    
 `title:"Advanced Sear*"`
  
    
    
Следующие запросы не возвращают ожидаемые результаты:
  
    
    
 `title:"Advan* Search"`
  
    
    
 `title:"Advanced Sear"`
  
    
    

#### Числовые значения свойств

В случае числовых значений свойств, к которым относятся управляемые типы **Integer**, **Double** и **Decimal**, ограничение свойства сопоставляется с полным значением свойства. 
  
    
    

### Значения даты и времени для свойств

В языке KQL для даты и времени предназначен тип данных **datetime**. В запросах поддерживаются следующие форматы даты и времени, совместимые с ISO 8601:
  
    
    

- YYYY-MM-DD
    
  
- YYYY-MM-DDThh:mm:ss
    
  
- YYYY-MM-DDThh:mm:ssZ
    
  
- YYYY-MM-DDThh:mm:ssfrZ
    
  
В этих форматах **datetime**:
  
    
    

- Параметр  _YYYY_ задает год из четырех цифр.
    
    > **Примечание**
      > Поддерживается только формат года из четырех цифр. 
- Параметр  _MM_ задает месяц в формате двух цифр. Например, 01  это январь.
    
  
- Параметр  _DD_ задает двузначное значение дня месяца (от 01 до 31).
    
  
- Параметр  _T_ обозначает букву "T".
    
  
- Параметр  _hh_ обозначает часы в формате двух цифр (от 00 до 23). Обозначения a.m. и p.m. не допускаются.
    
  
- Параметр  _mm_ обозначает минуты в формате двух цифр (от 00 до 59).
    
  
- Параметр  _ss_ обозначает секунды в формате двух цифр (от 00 до 59).
    
  
- Параметр  _fr_ задает доли секунды (необязательно). В этом случае используется от 1 до 7 цифр после разделителя (" **.**"), отделяющего доли секунды от секунд. Например, 2012-09-27T11:57:34.1234567.
    
  
Все значения даты и времени необходимо указывать в часовом поясе UTC (другое название  GMT). Идентификатор часового пояса UTC (символ "Z" в конце) указывать необязательно.
  
    
    

#### Соответствующие интервалы дат, поддерживаемые KQL

Язык KQL поддерживает реляционные запросы в диапазоне day, для которых зарезервированы ключевые слова, как показано в таблице 4. Используйте двойные кавычки ("") для интервалов дат, между их названиями ставьте пробел.
  
    
    


|**Имя интервала дат**|**Описание**|
|:-----|:-----|
|today  <br/> |Представляет период времени с начала текущего дня до его окончания.  <br/> |
|yesterday  <br/> |Представляет период времени с начала предшествующего дня до его окончания.  <br/> |
|this week  <br/> |Представляет период времени от начала текущей недели до ее окончания. При определении первого дня недели учитываются традиции региона, в котором формируется текст запроса.  <br/> |
|this month  <br/> |Представляет период времени с начала текущего месяца до его окончания.  <br/> |
|last month  <br/> |Представляет период времени от начала предыдущего месяца до его окончания.  <br/> |
|this year  <br/> |Представляет период времени от начала текущего года до его окончания.  <br/> |
|last year  <br/> |Представляет весь год, предшествующий текущему.  <br/> |
   

### Использование нескольких ограничений свойств в KQL-запросе

Служба Поиск в SharePoint 2013 поддерживает использование нескольких ограничений свойств в одном KQL-запросе. Можно использовать либо одно свойство для нескольких ограничений свойств, либо разные свойства для каждого ограничения свойств. 
  
    
    
Если вы используете несколько экземпляров ограничений свойств, поиск совпадений основан на объединении ограничений свойств в KQL-запросе. В этом примере совпадения включают элементы контента, автором которого является John Smith или Jane Smith:
  
    
    
 `author:"John Smith" author:"Jane Smith"`
  
    
    
Результат будет таким же, как и при использовании логического оператора **OR** в запросе, например:
  
    
    
 `author:"John Smith" OR author:"Jane Smith"`
  
    
    
Если вы используете различные ограничения свойств, поиск совпадений основан на пересечении ограничений свойств в KQL-запросе, например:
  
    
    
 `author:"John Smith" filetype:docx`
  
    
    
Совпадения будут содержать документы Microsoft Word, созданные пользователем John Smith. Такой же результат будет при использовании логического оператора **AND**, как показано в следующем примере:
  
    
    
 `author:"John Smith" AND filetype:docx`
  
    
    

## Операторы KQL для сложных запросов
<a name="kql_operators"> </a>

Синтаксис языка KQL включает несколько операторов, которые можно использовать для создания сложных запросов. 
  
    
    

### Логические операторы

Используйте логические операторы, чтобы расширить или сузить область поиска. Логические операторы в KQL-запросах можно использовать с произвольными выражениями и ограничениями свойств. В таблице 5 перечислены поддерживаемые логические операторы.
  
    
    

**Таблица 5. Логические операторы, поддерживаемые в KQL**


|**Оператор**|**Описание**|
|:-----|:-----|
|**AND** <br/> |Возвращает результаты поиска, содержащие все произвольные выражения или ограничения свойств, заданные оператором **AND**. Укажите допустимое произвольное текстовое выражение и (или) допустимое ограничение свойств перед оператором **AND** и после него. Представьте, что используете знак "+". <br/> |
|**NOT** <br/> |Возвращает результаты поиска, не содержащие заданных произвольных выражений или ограничений свойств. Укажите допустимое произвольное текстовое выражение и (или) допустимое ограничение свойств после оператора **NOT**. Представьте, что используете знак "-".  <br/> |
|**OR** <br/> |Возвращает результаты поиска, содержащие одно или несколько заданных произвольных выражений или ограничений свойств. Укажите допустимое произвольное текстовое выражение и (или) допустимое ограничение свойств перед оператором **OR** и после него. <br/> |
   

  
    
    

### Операторы поиска с учетом расположения

Используйте операторы поиска с учетом расположения, чтобы получить результаты, в которых заданные термины находятся в непосредственной близости друг от друга. Такие операторы вы можете использовать только с произвольными текстовыми выражениями: они не предназначены для использования с ограничениями свойств в KQL-запросах. Существует два оператора операторы поиска с учетом расположения: **NEAR** и **ONEAR**.
  
    
    

#### Оператор NEAR

Оператор **NEAR** возвращает совпадения, в которых заданные термины поиска находятся в непосредственной близости друг от друга (при этом не учитывается порядок следования терминов). Синтаксис оператора **NEAR**: 
  
    
    
 `<expression> NEAR(n=4) <expression>`
  
    
    
 _n_  необязательный параметр, указывающий максимальное расстояние между терминами. Параметр _n_ может принимать целые значения >= 0, значение по умолчанию: **8**.
  
    
    
Параметр  _n_ может быть задан как `n=v`, где  _v_  это значение. Можно указать и сокращенную форму: _v_. Например, в выражении  `NEAR(4)` параметр _v_ равен 4.
  
    
    
Например:
  
    
    
 `"acquisition" NEAR "debt"`
  
    
    
Результатом запроса будут элементы, в которых термины "acquisition" и "debt" появляются в одном элементе, в котором за термином "acquisition" следует до восьми других терминов, а за ними  "debt" (или наоборот). Порядок терминов при поиске совпадений не учитывается.
  
    
    
Если вам нужно меньшее расстояние между терминами, укажите его. Результатом следующего запроса будут элементы, в которых термины "acquisition" и "debt" появляются в одном элементе, при этом между ними не более трех терминов. Порядок следования терминов также не учитывается.
  
    
    
 `"acquisition" NEAR(n=3) "debt"`
  
    
    

> **Примечание**
> В SharePoint 2013 оператор **NEAR** больше не сохраняет порядок маркеров. Кроме того, оператор **NEAR** теперь содержит необязательный параметр, указывающий максимальное расстояние между маркерами. Значение по умолчанию также равно **8**. Если нужно использовать исходный порядок, используйте оператор **ONEAR**. 
  
    
    


#### Оператор ONEAR

Оператор **ONEAR** возвращает совпадения, в которых заданные термины поиска находятся в непосредственной близости друг от друга, при этом сохраняется порядок их следования. Ниже приведен синтаксис оператора **ONEAR**, где  _n_  необязательный параметр, указывающий максимальное расстояние между терминами. Параметр _n_ может принимать целые значения >= 0. Значение по умолчанию: **8**.
  
    
    
 `<expression> ONEAR(n=4) <expression>`
  
    
    
Параметр  _n_ может быть задан как `n=v`, где  _v_  это значение. Можно указать и сокращенную форму: _v_. Например, в выражении  `ONEAR(4)` параметр _v_ равен 4.
  
    
    
Например, результатом следующего запроса будут элементы, в которых термины "acquisition" и "debt" появляются в одном элементе, при этом за термином "acquisition" следует до восьми других терминов, а за ними  "debt". Порядок следования терминов **должен** совпадать с их порядком в возвращаемом элементе:
  
    
    
 `"acquisition" ONEAR "debt"`
  
    
    
Если требуется меньшее расстояние между терминами, укажите его, как показано в примере ниже. Результатом следующего запроса будут элементы, в которых термины "acquisition" и "debt" появляются в одном элементе, при этом между ними не более 3 терминов. Порядок следования терминов **должен** совпадать с их порядком в возвращаемом элементе:
  
    
    
 `"acquisition" ONEAR(n=3) "debt"`
  
    
    

### Операторы поиска синонимов

Используйте оператор **WORDS**, чтобы указать, что термины в запросе синонимичны, и возвращаемые результаты должны совпадать с любым из заданных терминов. Оператор **WORDS** вы можете использовать только с произвольными текстовыми выражениями. Его использование с ограничениями свойств в KQL-запросах не поддерживается.
  
    
    
Указанный ниже пример запроса выдает результаты, содержащие термин "TV" или "television". Под ним приведен еще один запрос, его результаты аналогичны предыдущим.
  
    
    
 `WORDS(TV, Television)`
  
    
    
 `TV OR Television`
  
    
    
Эти запросы отличаются ранжированием результатов. При использовании оператора **WORDS** термины "TV" и "television" рассматриваются как синонимы, а не как отдельные термины. Поэтому оба эти термина ранжируются, как если бы они были одним термином. Например, элемент контента, содержащий один термин "television" и пять терминов "TV", ранжируется так же, как элемент контента с шестью терминами "TV".
  
    
    

### Оператор подстановочного знака

Используйте оператор подстановочного знака (символ звездочки, " ***** "), чтобы включить сопоставление префиксов. Вы можете указать в запросе начальную часть слова, поставив далее оператор подстановочного знака. Результат следующего запроса  термины, начинающиеся на "serv" (при этом далее могут следовать другие знаки), например "serve", "server", "service":
  
    
    
 `serv*`
  
    
    

### Операторы включения и исключения

С помощью операторов включения и исключения, описанных в таблице 6, вы можете указать, будут ли возвращаемые результаты включать или исключать контент, совпадающий со значением, указанным в произвольном текстовом выражении или ограничении свойств.
  
    
    

**Таблица 6. Операторы для включения и исключения контента в результатах**


|**Имя**|**Оператор**|**Поведение**|
|:-----|:-----|:-----|
|Включение  <br/> |" **+** " <br/> |Включает в результаты контент со значениями, совпадающими с теми, которые нужно включить.  <br/> Это поведение по умолчанию, если символы не указаны. Аналогичный результат будет при использовании оператора **AND**.  <br/> |
|Исключение  <br/> |" **-** " <br/> |Исключает контент со значениями, совпадающими с теми, которые нужно исключить. Аналогичный результат будет при использовании оператора **NOT**.  <br/> |
   

### Оператор динамического ранжирования

Применяйте оператор **XRANK**, чтобы повысить динамический рейтинг элементов в зависимости от повторений определенных терминов в  _match expression_, не меняя состав элементов, удовлетворяющих критериям запроса. Выражение **XRANK** содержит один компонент, совпадение с которым обязательно ( _match expression_), и один или несколько компонентов, которые влияют только на динамическое ранжирование ( _rank expression_). Должен быть задан хотя бы **один** параметр (за исключением _n_), чтобы выражение **XRANK** было допустимым.
  
    
    
Параметр  _Match expressions_ может быть любым допустимым выражением KQL, включая вложенные выражения **XRANK**. Параметр  _Rank expressions_ может быть любым допустимым выражением в языке KQL, кроме выражений **XRANK**. Если KQL-запросы содержат несколько операторов **XRANK**, итоговое значение динамического рейтинга рассчитывается как сумма увеличений по всем операторам **XRANK**.
  
    
    

> **Примечание**
> Используйте скобки, чтобы явно указать порядок вычисления для KQL-запросов, содержащих более одного оператора **XRANK** на одном уровне.
  
    
    

Можно использовать следующий синтаксис оператора **XRANK**:
  
    
    
 `<match expression> XRANK(cb=100, rb=0.4, pb=0.4, avgb=0.4, stdb=0.4, nb=0.4, n=200) <rank expression>`
  
    
    
Динамического рейтинг с использованием оператора **XRANK** вычисляется по формуле:
  
    
    

  
    
    
![Формула для оператора XRANK](images/XRANKFormula.gif)
  
    
    
В таблице 7 перечислены основные параметры, доступные для оператора **XRANK**.
  
    
    

**Таблица 7. Параметры оператора XRANK**


|**Параметр**|**Значение**|**Описание**|
|:-----|:-----|:-----|
| _n_ <br/> | _<integer_value>_ <br/> |Указывает количество результатов для вычисления статистики.  <br/> Этот параметр не влияет на количество результатов, на которые влияет динамический рейтинг. С его помощью из вычисления статистики просто исключаются ненужные элементы.  <br/> По умолчанию: **0**. Нулевое значение означает *все документы*  . <br/> |
| _nb_ <br/> | _<float_value>_ <br/> |Параметр  _nb_ относится к нормированному увеличению. Этот параметр определяет коэффициент, на который умножается произведение дисперсии и среднего арифметического значений рейтингов в наборе результатов. <br/> Параметр  _f_ в формуле XRANK. <br/> |
   
Обычно нормированное увеличение ( _nb_)  единственный изменяемый параметр. Этого параметра достаточно, чтобы понижать или повышать рейтинг отдельного элемента, не учитывая стандартное отклонение. 
  
    
    
Доступны также дополнительные параметры, указанные ниже. Но обычно они не используются.
  
    
    

**Таблица 8. Дополнительные параметры оператора XRANK**


|**Параметр**|**Значение**|**Описание**|
|:-----|:-----|:-----|
| _cb_ <br/> | _<float_value>_ <br/> |Параметр  _cb_ увеличивает рейтинг на постоянную величину. <br/> По умолчанию: **0**. <br/> Параметр  _a_ в формуле XRANK. <br/> |
| _stdb_ <br/> | _<float_value>_ <br/> |Параметр  _stdb_ увеличивает рейтинг на величину стандартного отклонения. <br/> По умолчанию: **0**. <br/> Параметр  _e_ в формуле XRANK. <br/> |
| _avgb_ <br/> | _<float_value>_ <br/> |Параметр  _avgb_ увеличивает рейтинг на среднее значение. <br/> По умолчанию: **0**. <br/> Параметр  _d_ в формуле XRANK. <br/> |
| _rb_ <br/> | _<float_value>_ <br/> |Параметр  _rb_ увеличивает рейтинг в диапазоне. Этот коэффициент умножается на диапазон значений рейтингов в наборе результатов. <br/> По умолчанию: **0**. <br/> Параметр  _b_ в формуле XRANK. <br/> |
| _pb_ <br/> | _<float_value>_ <br/> |Параметр  _pb_ задает увеличение в процентах. Этот коэффициент умножается на собственный рейтинг элемента в сравнении с минимальным значением в наборе. <br/> По умолчанию: **0**. <br/> Параметр  _c_ в формуле XRANK. <br/> |
   

#### Примеры

 **Пример 1.** Следующее выражение сопоставляет элементы, для которых полнотекстовый индекс по умолчанию содержит "cat" или "dog". Выражение увеличивает на постоянную величину 100 динамический рейтинг элементов, содержащих также термин "thoroughbred".
  
    
    
 `(cat OR dog) XRANK(cb=100) thoroughbred`
  
    
    
 **Пример 2.** Следующее выражение сопоставляет элементы, для которых полнотекстовый индекс по умолчанию содержит термины "cat" или "dog". Выражение увеличивает динамический рейтинг элементов на нормированную величину 1,5 для элементов, содержащих также термин "thoroughbred".
  
    
    
 `(cat OR dog) XRANK(nb=1.5) thoroughbred`
  
    
    
 **Пример 3.** Следующее выражение сопоставляет элементы, для которых полнотекстовый индекс по умолчанию содержит термины "cat" или "dog". Выражение увеличивает динамический рейтинг элементов на постоянную величину 100 и нормированную величину 1,5 для элементов, содержащих также термин "thoroughbred".
  
    
    
 `(cat OR dog) XRANK(cb=100, nb=1.5) thoroughbred`
  
    
    
 **Пример 4.** Следующее выражение сопоставляет все элементы, содержащие термин "animals", и увеличивает динамический рейтинг следующим образом:
  
    
    

- динамический рейтинг элементов, содержащих термин "dogs", увеличивается на 100 баллов;
    
  
- динамический рейтинг элементов, содержащих термин "cats", увеличивается на 200 баллов;
    
  
- динамический рейтинг элементов, содержащих и термин "dogs", и термин "cats", увеличивается на 300 баллов.
    
  
 `(animals XRANK(cb=100) dogs) XRANK(cb=200) cats`
  
    
    

### Круглые скобки

Можно объединять разные части запросов по ключевым словам с помощью открывающей скобки " **(** " и закрывающей скобки " **)** ". Каждой открывающей скобке " **(** " должна соответствовать закрывающая скобка " **)** ". Пробел до или после скобки не влияет на запрос.
  
    
    

## Дополнительные ресурсы
<a name="SP15KQL_addlresources"> </a>


-  [Построение запросов поиска в SharePoint 2013](building-search-queries-in-sharepoint-2013.md)
    
  
